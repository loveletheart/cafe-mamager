<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>주문 화면</title>
  <style>
    .screen {
      width: 300px;
      height: 300px;
      border: 1px solid #ccc;
      margin: 10px;
      float: left;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      transition: box-shadow 0.3s ease-in-out;
      border-radius: 10px;
      position: relative;
      background-color: white;
    }
    .screen h2,
    .screen p {
      margin-left: 10px;
    }
    .screen hr {
      border: none;
      height: 2px;
      background-color: black;
    }
    .screen:hover {
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    .button {
      position: absolute;
      bottom: 10px;
      right: 10px;
      margin: 10px;
      padding: 5px 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .timer {
      float: right;
      margin-right: 10px;
      margin-top: 10px;
      font-size: 17px;
      font-weight: normal;
      font-family: Arial, sans-serif;
    }
  </style>
</head>
<body>
  <div id="container"></div>
	<script>
	  var container = document.getElementById("container");
	
	  // 서버에서 주문 데이터 가져오기
	  function fetchOrders() {
	    fetch('/orders/completed')
	      .then(response => response.json())
	      .then(data => {
	        container.innerHTML = ""; // 기존 화면 초기화
	        orderTimes = []; // 타이머 초기화
	
	        data.forEach((order, index) => {
	          createOrderScreen(order, index);
	        });
	      })
	      .catch(error => console.error('Error fetching orders:', error));
	  }
	
	  // 주문 화면 생성 함수
	  function createOrderScreen(order, index) {
	    var div = document.createElement("div");
	    div.className = "screen";
	    div.innerHTML = `<h2>주문 ${order.orderId} <span class='timer'>00:00:00</span></h2>`;
	
	    var hr = document.createElement("hr");
	    div.appendChild(hr);
	
	    // 주문한 메뉴 목록 추가
	    order.menuList.forEach(menu => {
	      var additionalContent = document.createElement("p");
	      additionalContent.innerHTML = `${menu.name} - ${menu.count}개`;
	      div.appendChild(additionalContent);
	    });
	
	    // 주문 시간 기록 (서버에서 가져온 시간 사용)
	    var orderTime = new Date(order.orderTime);
	    orderTimes.splice(index, 0, orderTime);
	
	    // 버튼 생성
	    var button = document.createElement("button");
	    button.textContent = "삭제";
	    button.className = "button";
	    button.addEventListener("click", function() {
	      container.removeChild(div);
	      orderTimes.splice(index, 1);
	    });
	
	    div.appendChild(button);
	    container.appendChild(div);
	  }
	
	  // 모든 주문 화면의 경과 시간을 업데이트하는 함수
	  function updateElapsedTime() {
	    var timerElements = document.querySelectorAll(".timer");
	    var screenElements = document.querySelectorAll(".screen");
	
	    timerElements.forEach(function(timerElement, i) {
	      if (orderTimes[i]) {
	        var currentTime = new Date();
	        var elapsedTime = Math.floor((currentTime - orderTimes[i]) / 1000);
	        timerElement.textContent = formatTime(elapsedTime);
	
	        // 경과 시간에 따라 배경색 변경
	        if (elapsedTime >= 600) {
	          screenElements[i].style.backgroundColor = "rgba(255, 0, 0, 0.5)";
	        } else if (elapsedTime >= 300) {
	          screenElements[i].style.backgroundColor = "rgba(255, 165, 0, 0.5)";
	        } else {
	          screenElements[i].style.backgroundColor = "white";
	        }
	      }
	    });
	  }
	
	  // 1초마다 updateElapsedTime 함수를 호출
	  setInterval(updateElapsedTime, 1000);
	
	  // 페이지 로딩 시 주문 데이터 가져오기
	  fetchOrders();
	
	  // 시간 형식 포맷팅 함수
	  function formatTime(time) {
	    var hours = Math.floor(time / 3600);
	    var minutes = Math.floor((time % 3600) / 60);
	    var seconds = time % 60;
	    return pad(hours) + ":" + pad(minutes) + ":" + pad(seconds);
	  }
	
	  function pad(num) {
	    return (num < 10 ? "0" : "") + num;
	  }
	</script>

</body>
</html>
